<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.5.55">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <meta name="dcterms.date" content="2024-07-24">

    <title>ChatGPT &amp; Google Gemini prompt</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "...html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>  <script>

    document.addEventListener("DOMContentLoaded", function() {

    // Select the abstract and keywords sections

    var abstractElement = document.querySelector('.abstract');

    var keywordsElement = document.querySelector('.keywords');

    

    // Select the introduction heading

    var introductionHeading = document.querySelector('h2[data-anchor-id="sec-introduction"]');

    

    if (abstractElement && introductionHeading) {

        // Create the new structure for the abstract section

        var newAbstractContainer = document.createElement('div');

        var newAbstractTitle = document.createElement('h3');

        newAbstractTitle.id = 'abstract';

        newAbstractTitle.className = 'mb-3 text-base font-semibold group';

        newAbstractTitle.innerHTML = 'Abstract<a class="no-underline text-inherit hover:text-inherit ml-2 select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#abstract" title="Link to Abstract" aria-label="Link to Abstract">Â¶</a>';



        var newAbstractContent = document.createElement('div');

        newAbstractContent.className = 'px-6 py-1 mb-3 rounded-sm bg-slate-50 dark:bg-slate-800';

        

        var newAbstractInnerContent = document.createElement('div');

        newAbstractInnerContent.id = 'soTooQ8JmG';

        newAbstractInnerContent.className = 'relative group/block col-body';



        // Move the actual abstract content

        var abstractParagraph = abstractElement.querySelector('p');

        newAbstractInnerContent.appendChild(abstractParagraph);

        

        // Append all new elements to the new abstract container

        newAbstractContent.appendChild(newAbstractInnerContent);

        newAbstractContainer.appendChild(newAbstractTitle);

        newAbstractContainer.appendChild(newAbstractContent);



        // Insert the new abstract container before the introduction heading

        introductionHeading.parentNode.insertBefore(newAbstractContainer, introductionHeading);



        // Remove the old abstract element

        abstractElement.remove();



        // Move the keywords section if it exists

        if (keywordsElement) {

            introductionHeading.parentNode.insertBefore(keywordsElement, introductionHeading);

        }

    }

});



</script>
  
      </head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> ChatGPT &amp; Google Gemini prompt</h6>

            <a href="../notebooks/causal-chains.ipynb" class="btn btn-primary quarto-download-embed" download="causal-chains.ipynb">Download Notebook</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">ChatGPT &amp; Google Gemini prompt</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Authors</div>
          <div class="quarto-title-meta-heading">Affiliations</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Peter SÃ¸gaard JÃ¸rgensen <a href="mailto:peter.sogaard.jorgensen@su.se" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-2621-378X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Sustainability Learning and Research Centre
                      </p>
                    <p class="affiliation">
                        Kungliga Vetenskapsuniversitetet
                      </p>
                    <p class="affiliation">
                        Stockholm Resilience Centre
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Diana Veronica Luna Gonzalez <a href="mailto:diana.lunagonzalez@su.se" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0003-0194-4137" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Stockholm Resilience Centre
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Luong Nguyen Thanh <a href="mailto:nguyen.luong@uu.se" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-9270-9345" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Sustainability Learning and Research Centre
                      </p>
                    <p class="affiliation">
                        Kungliga Vetenskapsuniversitetet
                      </p>
                    <p class="affiliation">
                        Uppsala Antibiotic Centre
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Melissa Barton <a href="mailto:melissa.barton@su.se" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0003-0661-134X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Stockholm Resilience Centre
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Kathryn Louise Bjorklund <a href="mailto:kathryn.bjorklund@su.se" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Stockholm Resilience Centre
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Ege Pehlivanoglu <a href="mailto:ege.pehlivanoglu@kva.se" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Kungliga Vetenskapsuniversitetet
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">July 24, 2024</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

     <div id="cell-1" class="cell markdown">

</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> causal_chains.CausalChain <span class="im">import</span> util  <span class="co"># https://github.com/helliun/causal-chains</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> google.generativeai <span class="im">as</span> genai</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.generativeai.types <span class="im">import</span> HarmCategory, HarmBlockThreshold</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> textwrap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>who_data <span class="op">=</span> pd.read_csv(<span class="st">"../data/corpus.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div id="cell-4" class="cell markdown">
<p>Causal text mining (CTM) has been applied to various NLP tasks such as <strong>knowledge base construction, question answering, and text summarization</strong> The methodologies of CTM often involve two phases: <strong>causal sequence classification and causal span detection</strong></p>
<ul>
<li>The causal sequence classification is a binary classification task to detect whether the sequence entails causality or not. This task requires a deep understanding of commonsense knowledge, as determining causality necessitates the comprehension of underlying real-world principles and contexts&nbsp;Gao et&nbsp;al.</li>
<li>The causal span detection task aims to distinguish between cause and effect arguments present in causal sequences. This task requires a precise understanding of a complex context that comprises multiple entities and events to discern which parts of sequences correspond to causes and effects and which are noise, in addition to the capabilities previously mentioned.</li>
</ul>
<p>Biomedical causal relations extracted from different resources, such as online journals, books, and reports, can be leveraged to form causal chains, which may result in the discovery of previously unknown relations.</p>
<p>CTM include various approaches</p>
<ul>
<li>&lt;font color=â#00b050â, style = âboldâ&gt;Knowledged-based system (expert opinions): relied heavily on domain experts to define rules and patterns for identifying causal relationships in text.</li>
<li><font color="#00b050">Machine learning:</font> Naive Bayes, Support Vector Machines (SVM), and Conditional Random Fields (CRF) were used to classify and extract causal relationships. These models required extensive feature engineering and relied on lexical and syntactic features such as keywords (âdue toâ, âcan causeâ), part-of-speech tags, and dependency relations. [[2024-05-13#Traditional machine learning methods]]</li>
<li><strong>Deep learning techniques</strong>
<ul>
<li><font color="#00b050">Multiview Convolutional Neural Networks (MVC):</font> This approach leverages multiple views of the input text to capture different aspects of the data. It can combine syntactic, semantic, and positional information to enhance causal relation extraction.</li>
<li><font color="#00b050">R</font><font color="#00b050">ecurrent Neural Networks (RNN):</font> BiLSTM (Bidirectional Long Short-Term Memory) models: These models can capture long-range dependencies in text by processing it in both forward and backward directions. Attention mechanisms are often integrated to focus on relevant parts of the text that contribute to causal relationships.</li>
<li><font color="#00b050">Graph Neural Networks (GNNs):</font> GNNs can model text as graphs, where nodes represent entities or concepts and edges represent relationships. This approach is beneficial for capturing complex causal structures.</li>
<li><font color="#00b050">Transformer Models</font>
<ul>
<li>Bidirectional Encoder Representations from Transformers (BERT): BERT is pre-trained on large corpora and can be fine-tuned for specific tasks. It captures context from both directions, making it effective for understanding complex dependencies in text. <font color="#f79646">Variants like BioBERT (for biomedical text) and ClinicalBERT are tailored for specific domains.</font></li>
<li>ELMo (Embeddings from Language Models): ELMo generates contextualized word embeddings by considering the entire sentence, providing richer representations for identifying causal relationships.</li>
</ul></li>
</ul></li>
</ul>
<p>LLMs&nbsp;have demonstrated impressive performance across numerous NLP tasks with zero-shot or few-shot in-context learning <strong>without requiring supervised training</strong> versus <strong><font color="#e36c09">traditional encoder-based models</font></strong></p>
<p>ChatGPT often <strong>demonstrates competitive results</strong> in few-shot settings even in financial domain-specific datasets and Japanese datasets, even though a fully trained encoder-based model outperforms ChatGPT. The result indicates that ChatGPT is a <strong>good starting point for various datasets especially when training data are unavailable</strong>, but not a good causal text miner when the training data are readily available.</p>
<p>The result indicates that ChatGPT serves as a good starting point when training data are limited as its performance is not influenced by the data size. In contrast, <strong>encoder models depend heavily on data size</strong></p>
<p>ChatGPT struggles with complex causality types, especially those of intra/inter-sentential and implicit causality</p>
</div>
<div id="cell-5" class="cell markdown">
<p><strong>Sample sentence</strong>: The sudden appearance of unlinked cases of mpox in South Africa without a history of international travel, the high HIV prevalence among confirmed cases, and the high case fatality ratio suggest that community transmission is underway, and the cases detected to date represent a small proportion of all mpox cases that might be occurring in the community; it is unknown how long the virus may have been circulating. This may in part be due to the lack of early clinical recognition of an infection with which South Africa previously gained little experience during the ongoing global outbreak, potential pauci-symptomatic manifestation of the disease, or delays in care-seeking behaviour due to limited access to care or fear of stigma.</p>
<p><strong>Expected results</strong>:</p>
<ul>
<li>Cause: lack of early clinical recognition of an infection -&gt; Effects: community transmission of mpox</li>
<li>Cause: pauci-symptomatic manifestation of the disease -&gt; Effects: lack of early clinical recognition of an infection</li>
<li>Cause: delays in care-seeking behaviour -&gt; Effects: lack of early clinical recognition of an infection</li>
<li>Cause: limited access to care -&gt; Effect: delays in care-seeking behaviour</li>
<li>Cause: fear of stigma -&gt; Effect: delays in care-seeking behaviour</li>
</ul>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>openai.api_key <span class="op">=</span> os.getenv(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>gemini_api_key <span class="op">=</span> os.getenv(<span class="st">"GEMINI_API_KEY"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the Gemini API client</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>genai.configure(api_key<span class="op">=</span>gemini_api_key)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>safety_filters <span class="op">=</span> {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT: HarmBlockThreshold.BLOCK_NONE,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT: HarmBlockThreshold.BLOCK_NONE,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    HarmCategory.HARM_CATEGORY_HATE_SPEECH: HarmBlockThreshold.BLOCK_NONE,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    HarmCategory.HARM_CATEGORY_HARASSMENT: HarmBlockThreshold.BLOCK_NONE</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... add other categories if you need them and set them to BLOCK_NONE</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CausalChain:</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    one_shot_example <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="st">    Example of disease transmission</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="st">    Text: The sudden appearance of unlinked cases of mpox in South Africa without a history of international travel, the high HIV prevalence among confirmed cases, and the high case fatality ratio suggest that community transmission is underway, and the cases detected to date represent a small proportion of all mpox cases that might be occurring in the community; it is unknown how long the virus may have been circulating. This may in part be due to the lack of early clinical recognition of an infection with which South Africa previously gained little experience during the ongoing global outbreak, potential pauci-symptomatic manifestation of the disease, or delays in care-seeking behaviour due to limited access to care or fear of stigma.</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="st">    Question: Which drivers cause the emergence or transmission of an infectious disease outbreak in the region?</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="st">    Answer: </span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: limited access to care (Public Health Systems) -&gt; Effect: delays in care-seeking behaviour (Social &amp; Demographic Change)</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: fear of stigma (Social &amp; Demographic Change) -&gt; Effect: delays in care-seeking behaviour (Social &amp; Demographic Change)</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: delays in care-seeking behaviour (Social &amp; Demographic Change) -&gt; Effect: lack of early clinical recognition of an infection (Public Health Systems)</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: pauci-symptomatic manifestation of the disease (Disease characteristics) -&gt; Effect: lack of early clinical recognition of an infection (Public Health Systems)</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: lack of early clinical recognition of an infection (Public Health Systems) -&gt; Effect: community transmission of mpox (Disease transmission)</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    two_shot_example <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="st">    Example of disease emergence</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="st">    Text: The risk of dengue is similar across regions, countries, and within countries. Factors associated with an increasing risk of dengue epidemics and spread to new countries include: early start and longer duration of dengue transmission seasons in endemic areas; changing distribution and increasing abundance of the vectors (Aedes aegypti and Aedes albopictus); consequences of climate change and periodic weather phenomena (El Nino and La Nina events) leading to heavy precipitation, humidity, and rising temperatures favouring vector reproduction and virus transmission;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="st">    Question: Which drivers cause the emergence or transmission of an infectious disease outbreak in the region?</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="st">    Answer: </span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: consequences of climate change and periodic weather phenomena (Globalization &amp; Environmental Change) -&gt; Effect: vector reproduction and virus transmission (Disease characteristics)</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: vector reproduction and virus transmission (Disease characteristics) -&gt; Effect: changing distribution and increasing abundance of the vectors (Disease characteristics)</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: changing distribution and increasing abundance of the vectors (Disease characteristics) -&gt; Effect: early start and longer duration of dengue transmission seasons in endemic areas (Disease characteristics)</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="st">    Cause: early start and longer duration of dengue transmission seasons in endemic areas (Disease characteristics) -&gt; Effect: increasing risk of dengue epidemics and spread to new countries (Disease emergence)</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    prompt_template <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="st">    Infectious disease (ID) events occur when an underlying mix of antecedent epidemiologic drivers provide the necessary conditions for a pathogen to emerge in susceptible populations. </span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="st">    These conditions may be driving emergence and transmission through a wide variety of mechanisms, mainly among 5 groups:</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="st">    Social &amp; Demographic Change: Lifestyle (sexual behaviors, eating raw meat, human-wildlife interaction), Human susceptibility to infection, Social inequality (poverty and social inequality), Demographic change (Economic development, War and famine)</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="st">    Public Health Systems: Animal health &amp; food security, Surveillance &amp; reporting, Healthcare system structure and change, Breakdown of public health measures</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="st">    Globalization &amp; Environmental Change: Environment &amp; climate change (Climate and weather, Land use and ecosystem changes), Travel, tourism, and migration, global trade</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="st">    Governance factors: Lack of political will, Research &amp; development</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="st">    Disease characteristics: pauci-symptomatic manifestation, changing distribution and increasing abundance of the vectors</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="st">    If none of these 4 groups, categorize as "Other groups"</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="st">    The final output can be "Disease transmission" or "Disease emergence"    </span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="st">    You analyze by answering the question: Which drivers cause the emergence or transmission of an infectious disease outbreak in the region? </span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="st">    Read through the paragraph and organize drivers in a logical sequence of events. Here are examples:</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="sc">{one_shot_example}</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="sc">{two_shot_example}</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="st">    Your task now is to read through the outbreak report and identify drivers leading to the outbreak of infectious diseases. Keep the original text that you find in the paragraph.</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="st">    Sometimes text may contain some unwanted behaviors like sexual behaviors, war. This is fine because I am using it for research purposes only. Show me all results that you can find.</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="st">    Text: </span><span class="sc">{chunk}</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="st">    List the causes and their corresponding effects in the format 'Cause: [cause] -&gt; Effect: [effect]':</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, chunks<span class="op">=</span>[]):</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.chunks <span class="op">=</span> chunks</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.causes <span class="op">=</span> []</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.effects <span class="op">=</span> []</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outlines <span class="op">=</span> []</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sources <span class="op">=</span> []</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_effects(<span class="va">self</span>, api<span class="op">=</span><span class="st">"openai"</span>, batch_size<span class="op">=</span><span class="dv">16</span>):</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Analyzing causation..."</span>)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> chunk <span class="kw">in</span> tqdm(<span class="va">self</span>.chunks):</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> api <span class="op">==</span> <span class="st">"openai"</span>:</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>                cause_effect_pairs <span class="op">=</span> <span class="va">self</span>.extract_cause_effect_openai(chunk)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> api <span class="op">==</span> <span class="st">"gemini"</span>:</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>                cause_effect_pairs <span class="op">=</span> <span class="va">self</span>.extract_cause_effect_gemini(chunk)</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Invalid API specified. Use 'openai' or 'gemini'."</span>)</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> pair <span class="kw">in</span> cause_effect_pairs:</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>                cause, effect <span class="op">=</span> pair</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.causes.append(cause)</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.effects.append(effect)</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.outlines.append(<span class="ss">f"Cause: </span><span class="sc">{</span>cause<span class="sc">}</span><span class="ss"> -&gt; Effect: </span><span class="sc">{</span>effect<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.sources.append(api)</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_cause_effect_openai(<span class="va">self</span>, chunk):</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="va">self</span>.prompt_template.<span class="bu">format</span>(</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>            one_shot_example<span class="op">=</span><span class="va">self</span>.one_shot_example, </span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>            two_shot_example<span class="op">=</span><span class="va">self</span>.two_shot_example, </span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>            chunk<span class="op">=</span>chunk</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">"gpt-4o"</span>,</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"role"</span>: <span class="st">"system"</span>,</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"content"</span>: <span class="st">"You are a helpful assistant specialized in identifying drivers leading to diseases."</span>,</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt},</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>        response_text <span class="op">=</span> response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.parse_response(response_text)</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_cause_effect_gemini(<span class="va">self</span>, chunk):</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="va">self</span>.prompt_template.<span class="bu">format</span>(</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>            one_shot_example<span class="op">=</span><span class="va">self</span>.one_shot_example, </span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>            two_shot_example<span class="op">=</span><span class="va">self</span>.two_shot_example, </span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>            chunk<span class="op">=</span>chunk</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> genai.GenerativeModel(<span class="st">'gemini-1.5-pro'</span>).generate_content(</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>            prompt,</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>            safety_settings<span class="op">=</span> safety_filters</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>        response_text <span class="op">=</span> response.text</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.parse_response(response_text)</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_response(response_text):</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>        cause_effect_pairs <span class="op">=</span> []</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> response_text.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>):</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"Cause:"</span> <span class="kw">in</span> line <span class="kw">and</span> <span class="st">"-&gt; Effect:"</span> <span class="kw">in</span> line:</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>                cause <span class="op">=</span> line.split(<span class="st">"Cause:"</span>)[<span class="dv">1</span>].split(<span class="st">"-&gt; Effect:"</span>)[<span class="dv">0</span>].strip()</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>                effect <span class="op">=</span> line.split(<span class="st">"-&gt; Effect:"</span>)[<span class="dv">1</span>].strip()</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>                cause_effect_pairs.append((cause, effect))</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cause_effect_pairs</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_causes_effects_dataframe(causes, effects, sources):</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> split_cause_effect(value):</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"("</span> <span class="kw">in</span> value <span class="kw">and</span> <span class="st">")"</span> <span class="kw">in</span> value:</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>            main_text, group <span class="op">=</span> value.rsplit(<span class="st">"("</span>, <span class="dv">1</span>)</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>            main_text <span class="op">=</span> main_text.strip()</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>            group <span class="op">=</span> group[:<span class="op">-</span><span class="dv">1</span>].strip()  <span class="co"># Remove the closing parenthesis</span></span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> main_text, group</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> value, <span class="st">"Unknown"</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    cause_texts, cause_groups <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>[split_cause_effect(cause) <span class="cf">for</span> cause <span class="kw">in</span> causes])</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    effect_texts, effect_groups <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>[split_cause_effect(effect) <span class="cf">for</span> effect <span class="kw">in</span> effects])</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Cause"</span>: cause_texts,</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Cause_group"</span>: cause_groups,</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Effect"</span>: effect_texts,</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Effect_group"</span>: effect_groups,</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Source"</span>: sources</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div id="cell-7" class="cell markdown">
<p><strong>Example of text to ask LLMs</strong></p>
<p>In the Democratic Republic of the Congo, most reported cases in known endemic provinces continue to be among children under 15 years of age, especially in young children. Infants and children under five years of age are at highest risk of severe disease and death, <strong>particularly where prompt optimal case management is limited or unavailable</strong>. The number of cases reported weekly remains consistently high while the outbreak continues to expand geographically. High test positivity among tested cases in most provinces also suggests that undetected transmission is likely ongoing in the community. Transmission of mpox due to clade I MPXV via <strong>sexual contact</strong> in key populations was first identified in the Democratic Republic of the Congo in 2023. In South Kivu province, mpox transmission is sustained through <strong>human-to-human contact (sexual and non-sexual)</strong></p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [128]:</pre></div><div id="cell-8" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> who_data[<span class="st">"Text"</span>][<span class="dv">9</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>chunks <span class="op">=</span> util.create_chunks(text)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>cc <span class="op">=</span> CausalChain(chunks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [130]:</pre></div><div id="cell-9" class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>cc.create_effects(api<span class="op">=</span><span class="st">"openai"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analyzing causation...
Analyzing causation...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  0%|                                                   | 0/12 [00:00&lt;?, ?it/s]  8%|ââââ                                       | 1/12 [00:03&lt;00:40,  3.67s/it] 17%|ââââââââ                                   | 2/12 [00:06&lt;00:30,  3.09s/it] 25%|âââââââââââ                                | 3/12 [00:10&lt;00:32,  3.58s/it] 33%|âââââââââââââââ                            | 4/12 [00:12&lt;00:24,  3.01s/it] 42%|ââââââââââââââââââ                         | 5/12 [00:15&lt;00:19,  2.78s/it] 50%|ââââââââââââââââââââââ                     | 6/12 [00:17&lt;00:16,  2.83s/it] 58%|âââââââââââââââââââââââââ                  | 7/12 [00:20&lt;00:14,  2.84s/it] 67%|âââââââââââââââââââââââââââââ              | 8/12 [00:23&lt;00:11,  2.85s/it] 75%|âââââââââââââââââââââââââââââââââ          | 9/12 [00:26&lt;00:08,  2.76s/it] 83%|âââââââââââââââââââââââââââââââââââ       | 10/12 [00:28&lt;00:05,  2.72s/it] 92%|âââââââââââââââââââââââââââââââââââââââ   | 11/12 [00:33&lt;00:03,  3.40s/it]100%|ââââââââââââââââââââââââââââââââââââââââââ| 12/12 [00:37&lt;00:00,  3.49s/it]100%|ââââââââââââââââââââââââââââââââââââââââââ| 12/12 [00:37&lt;00:00,  3.13s/it]</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [129]:</pre></div><div id="cell-10" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cc.create_effects(api<span class="op">=</span><span class="st">"gemini"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analyzing causation...
Analyzing causation...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  0%|                                                   | 0/12 [00:00&lt;?, ?it/s]  8%|ââââ                                       | 1/12 [00:12&lt;02:12, 12.07s/it] 17%|ââââââââ                                   | 2/12 [00:19&lt;01:31,  9.12s/it] 25%|âââââââââââ                                | 3/12 [00:21&lt;00:56,  6.25s/it] 33%|âââââââââââââââ                            | 4/12 [00:29&lt;00:54,  6.78s/it] 42%|ââââââââââââââââââ                         | 5/12 [00:41&lt;00:59,  8.53s/it] 50%|ââââââââââââââââââââââ                     | 6/12 [00:46&lt;00:44,  7.37s/it] 58%|âââââââââââââââââââââââââ                  | 7/12 [00:49&lt;00:30,  6.01s/it] 67%|âââââââââââââââââââââââââââââ              | 8/12 [01:01&lt;00:31,  7.87s/it] 75%|âââââââââââââââââââââââââââââââââ          | 9/12 [01:02&lt;00:17,  5.90s/it] 83%|âââââââââââââââââââââââââââââââââââ       | 10/12 [01:05&lt;00:09,  4.79s/it] 92%|âââââââââââââââââââââââââââââââââââââââ   | 11/12 [01:12&lt;00:05,  5.68s/it]100%|ââââââââââââââââââââââââââââââââââââââââââ| 12/12 [01:18&lt;00:00,  5.75s/it]100%|ââââââââââââââââââââââââââââââââââââââââââ| 12/12 [01:18&lt;00:00,  6.57s/it]</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [135]:</pre></div><div id="cell-11" class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> create_causes_effects_dataframe(cc.causes, cc.effects, cc.sources)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [136]:</pre></div><div id="cell-12" class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>display(df[df[<span class="st">'Source'</span>] <span class="op">==</span> <span class="st">'gemini'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cause</th>
<th data-quarto-table-cell-role="th">Cause_group</th>
<th data-quarto-table-cell-role="th">Effect</th>
<th data-quarto-table-cell-role="th">Effect_group</th>
<th data-quarto-table-cell-role="th">Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Limited availability of prompt optimal case ma...</td>
<td>Public Health Systems</td>
<td>Infants and children under five years of age a...</td>
<td>Social &amp; Demographic Change)*</td>
<td>gemini</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>** human-to-human contact</td>
<td>sexual and non-sexual) *</td>
<td>** Transmission of mpox</td>
<td>Disease Transmission</td>
<td>gemini</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>** sexual contact in key populations **</td>
<td>Unknown</td>
<td>** Transmission of mpox due to clade I MPXV</td>
<td>Disease Transmission</td>
<td>gemini</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>** undetected transmission in the community **</td>
<td>Unknown</td>
<td>** High test positivity among tested cases</td>
<td>Disease Transmission</td>
<td>gemini</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>**lack of timely access to diagnostics in many...</td>
<td>Public Health Systems</td>
<td>**incomplete epidemiological investigations**</td>
<td>Public Health Systems</td>
<td>gemini</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>**incomplete epidemiological investigations**</td>
<td>Public Health Systems</td>
<td>**challenges in contact tracing**</td>
<td>Public Health Systems</td>
<td>gemini</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>**challenges in contact tracing**</td>
<td>Public Health Systems</td>
<td>**the outbreak in South Kivu is already spread...</td>
<td>Disease transmission</td>
<td>gemini</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>eradication of smallpox</td>
<td>Public Health Systems</td>
<td>immunity gap</td>
<td>Social &amp; Demographic Change</td>
<td>gemini</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>MPXV continues to move into the immunity gap</td>
<td>Disease characteristics</td>
<td>human-to-human transmission</td>
<td>Disease transmission</td>
<td>gemini</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>logistical and resource challenges</td>
<td>Public Health Systems</td>
<td>limited Surveillance and investigating alerts</td>
<td>Public Health Systems</td>
<td>gemini</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>limited laboratory capacities</td>
<td>Public Health Systems</td>
<td>limited Surveillance and investigating alerts</td>
<td>Public Health Systems</td>
<td>gemini</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>lack of effective dissemination to date of hea...</td>
<td>Public Health Systems</td>
<td>low awareness of the risks associated with mpox</td>
<td>Social &amp; Demographic Change)*</td>
<td>gemini</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>low awareness of the risks associated with mpox</td>
<td>Social &amp; Demographic Change</td>
<td>exposes them to further risk</td>
<td>Disease Transmission)*</td>
<td>gemini</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>** River boat travel</td>
<td>Globalization &amp; Environmental Change) *</td>
<td>** Outbreaks in Kinshasa</td>
<td>Disease transmission</td>
<td>gemini</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>** Co-infections with HIV and other sexually t...</td>
<td>Social &amp; Demographic Change) *</td>
<td>** Increased severity of MPXV</td>
<td>Disease Transmission</td>
<td>gemini</td>
</tr>
</tbody>
</table>

</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [137]:</pre></div><div id="cell-13" class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>display(df[df[<span class="st">'Source'</span>] <span class="op">==</span> <span class="st">'openai'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cause</th>
<th data-quarto-table-cell-role="th">Cause_group</th>
<th data-quarto-table-cell-role="th">Effect</th>
<th data-quarto-table-cell-role="th">Effect_group</th>
<th data-quarto-table-cell-role="th">Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>limited or unavailable prompt optimal case man...</td>
<td>Public Health Systems</td>
<td>high risk of severe disease and death in infan...</td>
<td>Social &amp; Demographic Change</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>high risk of severe disease and death in infan...</td>
<td>Social &amp; Demographic Change</td>
<td>consistently high number of cases reported weekly</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>consistently high number of cases reported weekly</td>
<td>Disease transmission</td>
<td>outbreak continues to expand geographically</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>high test positivity among tested cases in mos...</td>
<td>Public Health Systems</td>
<td>undetected transmission likely ongoing in the ...</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>sexual contact in key populations</td>
<td>Social &amp; Demographic Change</td>
<td>transmission of mpox due to clade I MPXV</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>human-to-human contact (sexual and non-sexual)...</td>
<td>Social &amp; Demographic Change</td>
<td>sustained mpox transmission</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>sexual contact</td>
<td>Social &amp; Demographic Change</td>
<td>faster transmission</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>immune suppression, especially among those wit...</td>
<td>Social &amp; Demographic Change</td>
<td>risk factors for severe disease and death amon...</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>prevalence of HIV in the general adult populat...</td>
<td>Social &amp; Demographic Change</td>
<td>higher risk of severe disease and death among ...</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>sustained human-to-human sexual transmission o...</td>
<td>Social &amp; Demographic Change</td>
<td>additional public health impact</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>higher HIV prevalence in the eastern provinces</td>
<td>Social &amp; Demographic Change</td>
<td>higher risk of severe disease and death among ...</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>lack of timely access to diagnostics in many a...</td>
<td>Public Health Systems</td>
<td>incomplete epidemiological investigations</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>incomplete epidemiological investigations</td>
<td>Public Health Systems</td>
<td>challenges in contact tracing</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>challenges in contact tracing</td>
<td>Public Health Systems</td>
<td>outbreak spreading into the wider community</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>outbreak spreading into the wider community</td>
<td>Disease transmission</td>
<td>occurrence of cases among a broad range of occ...</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>new features of human-to-human transmission</td>
<td>Disease characteristics</td>
<td>further rapid expansion of the outbreak</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>further rapid expansion of the outbreak</td>
<td>Disease transmission</td>
<td>geographic expansion to new areas, such as Kin...</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32</td>
<td>geographic expansion to new areas, such as Kin...</td>
<td>Disease transmission</td>
<td>increase in suspected cases reported</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>travel from endemic areas</td>
<td>Globalization &amp; Environmental Change</td>
<td>cases in newly affected provinces</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34</td>
<td>secondary or sustained human-to-human transmis...</td>
<td>Disease transmission</td>
<td>cases in newly affected provinces</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>immunity gap left following eradication of sma...</td>
<td>Social &amp; Demographic Change</td>
<td>MPXV continues to move</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36</td>
<td>logistical and resource challenges</td>
<td>Public Health Systems</td>
<td>limited surveillance and investigating alerts</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37</td>
<td>limited laboratory capacities</td>
<td>Public Health Systems</td>
<td>limited surveillance and investigating alerts</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>reliance on the support of WHO and other partners</td>
<td>Public Health Systems</td>
<td>response capacities to mpox in the country</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>ongoing immunogenicity and safety studies of M...</td>
<td>Governance factors</td>
<td>national immunization technical advisory group...</td>
<td>Governance factors</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">40</td>
<td>national immunization technical advisory group...</td>
<td>Governance factors</td>
<td>use of mpox vaccines in the country for person...</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>recommendations for preferred use of LC16 in c...</td>
<td>Governance factors</td>
<td>immunization strategy for different age groups</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>intention to vaccinate persons at risk</td>
<td>Governance factors</td>
<td>use of LC16 and MVA-BN vaccinia-based mpox vac...</td>
<td>Governance factors</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43</td>
<td>request for authorization of temporary use of ...</td>
<td>Governance factors</td>
<td>regulatory review by ACOREP</td>
<td>Governance factors</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">44</td>
<td>regulatory review by ACOREP</td>
<td>Governance factors</td>
<td>temporary use of these vaccines</td>
<td>Governance factors</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">45</td>
<td>planning of further clinical efficacy and safe...</td>
<td>Governance factors</td>
<td>further clinical efficacy and safety studies f...</td>
<td>Governance factors</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">46</td>
<td>developing emergency response immunization str...</td>
<td>Public Health Systems</td>
<td>persons and areas at risk are targeted</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">47</td>
<td>extensive consultation internally, with WHO an...</td>
<td>Governance factors</td>
<td>development of emergency response immunization...</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">48</td>
<td>clinical efficacy studies of tecovirimat</td>
<td>Governance factors</td>
<td>potential future access to tecovirimat</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>study expected to complete recruitment in 2024</td>
<td>Governance factors</td>
<td>delayed access to tecovirimat until study comp...</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50</td>
<td>low awareness of the risks associated with mpo...</td>
<td>Public Health Systems</td>
<td>increased risk of disease transmission in the ...</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">51</td>
<td>lack of effective dissemination of health mess...</td>
<td>Public Health Systems</td>
<td>increased risk for key populations such as sex...</td>
<td>Social &amp; Demographic Change</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">52</td>
<td>increased risk for key populations such as sex...</td>
<td>Social &amp; Demographic Change</td>
<td>further exposure to mpox</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">53</td>
<td>co-infections with HIV and other sexually tran...</td>
<td>Social &amp; Demographic Change</td>
<td>outbreaks in newly reported areas in southern ...</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">54</td>
<td>river boat travel</td>
<td>Globalization &amp; Environmental Change</td>
<td>outbreaks in the city of Kinshasa</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55</td>
<td>under detection or underreporting of transmission</td>
<td>Public Health Systems</td>
<td>significant under detection or underreporting ...</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">56</td>
<td>resources to respond over such a wide geograph...</td>
<td>Public Health Systems</td>
<td>insufficient response to the outbreak</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">57</td>
<td>resource mobilization is slow</td>
<td>Public Health Systems</td>
<td>insufficient response to the outbreak</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">58</td>
<td>public awareness remains limited</td>
<td>Social &amp; Demographic Change</td>
<td>insufficient response to the outbreak</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">59</td>
<td>resources are scarce</td>
<td>Public Health Systems</td>
<td>insufficient response to the outbreak</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60</td>
<td>technical and financial support is needed</td>
<td>Public Health Systems</td>
<td>insufficient response to the outbreak</td>
<td>Public Health Systems</td>
<td>openai</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61</td>
<td>insufficient response to the outbreak</td>
<td>Public Health Systems</td>
<td>continuation of disease transmission</td>
<td>Disease transmission</td>
<td>openai</td>
</tr>
</tbody>
</table>

</div>
</div>
</div></div>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content --> 
  
</body></html>